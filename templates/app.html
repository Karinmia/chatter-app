{% extends "base.html" %}

{% block head_addons %}
  <link rel="stylesheet" href="{{url_for('static', path='/css/app.css')}}" type="text/css">
{% endblock %}

{% block content %}
<div id="left-wrapper">
  {% for channel in channels %}
    <div id="{{ channel.id }}" class="channel"
      hx-get="/api/channels/{{channel.id}}/messages" 
      hx-target="#messages" hx-swap="innerHTML"
    >
      <div class="channel-name">{{ channel.name }}</div>
      <div class="channel-details">some details...</div>
    </div>
  {% endfor %}
</div>
<div id="right-wrapper">
  <div id="select-channel">Select a chat to start messaging.</div>
  <div class="messages-wrapper" id="messages">
    {% include "messages.html" ignore missing with context %}
  </div>
  <div id="input-wrapper">
    <input type="text" name="message" id="message"
      placeholder="{{active_channel}}"
      hx-trigger="input changed">
    <button type="button" class="btn" hx-post="/send-message" id="sendMessage">
      Send
    </button>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    // hide messages and users input unless a channel is selected
    document.getElementById("messages").style.display = "none";
    document.getElementById("input-wrapper").style.display = "none";
  });

  document.getElementById('left-wrapper').addEventListener('htmx:afterRequest', function(event) {
      // remove the 'active' class from all channels
      document.querySelectorAll('.channel.active').forEach(function(channel) {
        channel.classList.remove('active');
      });

      // Add the active class to the clicked tab
      event.target.classList.add('active');
      
      document.getElementById("select-channel").style.display = "none";
      document.getElementById("messages").style.display = "flex";
      document.getElementById("input-wrapper").style.display = "flex";
  });
</script>
{% endblock %}
<!-- <script type="text/javascript">
  console.log("here");
  document.getElementById("error-message").addEventListener("htmx:beforeSwap", (event)=>{
    console.log("inside EventListener");
    console.log(event.detail.xhr.status);
    console.log(event.detail);
    // After server validation
    if (event.detail.isError) {
        event.detail.shouldSwap = true;
        // No need to set new target since the form is already the target
    } else {
      // event.detail.target = "#main-container";
      event.detail.target = null;
      event.detail.shouldSwap = false;
    }
    return
    // Else reset form and hide modal
})
</script> -->